# 体操競技Dスコア計算マスター知識ベース

このファイルは、体操競技のDスコア計算に関する全ての正確なルールと実装方法をまとめた決定版ドキュメントです。
AIチャットはこの情報を基に、連続技実装や難度計算に関する質問に正確に回答します。

## 📋 目次

1. [基本Dスコア計算式](#基本dスコア計算式)
2. [床運動(FX)の連続技・組合せ加点](#床運動fxの連続技組合せ加点)
3. [鉄棒(HB)の組合せ加点](#鉄棒hbの組合せ加点)
4. [つり輪(SR)の連続技](#つり輪srの連続技)
5. [ND減点システム](#nd減点システム)
6. [終末技グループ加点](#終末技グループ加点)
7. [実装時の重要ポイント](#実装時の重要ポイント)

---

## 基本Dスコア計算式

```
Dスコア = 難度点 + グループボーナス + 終末技グループ加点 + 連続技ボーナス - ND減点

最終Dスコア = max(0.0, 上記計算結果)
```

### 難度価値表
| A | B | C | D | E | F | G | H | I | J |
|---|---|---|---|---|---|---|---|---|---|
| 0.1 | 0.2 | 0.3 | 0.4 | 0.5 | 0.6 | 0.7 | 0.8 | 0.9 | 1.0 |

---

## 床運動(FX)の連続技・組合せ加点

### ✅ 連続技可能な組み合わせ（UI制御）
| 前技＼後技 | グループⅡ（前方系） | グループⅢ（後方系） | グループⅣ（側方系） |
|-----------|-------------------|-------------------|-------------------|
| **グループⅠ（技術系）** | ❌ 不可 | ❌ 不可 | ❌ 不可 |
| **グループⅡ（前方系）** | ✅ 可能 | ❌ 不可 | ✅ 可能 |
| **グループⅢ（後方系）** | ❌ 不可 | ✅ 可能 | ✅ 可能 |
| **グループⅣ（側方系）** | ✅ 可能 | ✅ 可能 | ❌ 不可 |

**連続技ルール**: グループⅡ+グループⅡ/Ⅳ、グループⅢ+グループⅢ/Ⅳ（順不同）

### 🎯 組合せ加点（CV）ルール

#### 基本パターン
1. **D難度以上 + D難度以上 = +0.2点**
2. **D難度以上 + B/C難度 = +0.1点**（双方向有効）

#### 重要な制限事項
1. **グループⅠ（技術的グループ）**: 組合せ加点の対象外
2. **グループⅣ同士**: 加点なし
3. **切り返し系宙返り技**: 加点なし
   - **定義**: 前方系（グループⅡ）↔ 後方系（グループⅢ）の組み合わせ
   - 順序に関係なく加点されない
4. **ひねりを伴う1回宙返り技の直接連続**: 加点なし
5. **カウント条件**: 両技ともカウントされる8技に含まれている必要がある

#### ✅ 加点される例
- 後方2回宙返り（D難度）+ 後方宙返り1回ひねり（B難度）= +0.1点
- 側方宙返り（D難度）+ 後方宙返り（B難度）= +0.1点

#### ❌ 加点されない例
- 後方2回宙返り（D難度）+ 前方宙返り（B難度）= **加点なし**（切り返し系）
- 前方宙返り（B難度）+ 後方2回宙返り（D難度）= **加点なし**（切り返し系）

---

## 鉄棒(HB)の組合せ加点

### 🎯 手放し技同士の組み合わせ（グループⅡ + グループⅡ）
| 組み合わせ | 加点 |
|-----------|------|
| C難度 + D難度以上 | +0.10点（双方向） |
| D難度 + D難度 | +0.10点 |
| D難度以上 + E難度以上 | +0.20点（双方向） |

### 🎯 EGⅠまたはⅢの技 + 手放し技
| 組み合わせ | 加点 |
|-----------|------|
| D難度以上（EGⅠ/Ⅲ）+ D難度（手放し技） | +0.10点 |
| D難度以上（EGⅠ/Ⅲ）+ E難度以上（手放し技） | +0.20点（双方向） |

**注意**: EGⅠ = グループⅠ（懸垂振動技）、EGⅢ = グループⅢ（バーに近い技・アドラー系の技）

---

## つり輪(SR)の連続技

### 静止技連続ボーナス
- **十字懸垂(2秒) + 中水平支持(2秒)**: +0.2点
- **倒立(2秒) + 十字懸垂(2秒)**: +0.1点

---

## ND減点システム

**ルールブック6-3条「短い演技に対して」**

| 技数 | ND減点 |
|------|--------|
| 8技 | 0.0点 |
| 7技 | 0.0点 |
| 6技 | 0.0点 |
| **5技** | **3.0点** |
| **4技** | **4.0点** |
| 3技 | 5.0点 |
| 2技 | 6.0点 |
| 1技 | 7.0点 |
| 0技 | 10.0点 |

**重要**: 跳馬はND減点の対象外

---

## 終末技グループ加点

**ルールブック7-2条第8項・第9項**

### グループ加点
- **終末技の難度価値点と同じ点数のグループ加点**
- 床運動・跳馬以外の全種目に適用

### 着地加点（参考情報）
- あん馬を除き、C難度以上の終末技で着地を止めた場合+0.1点
- 基本Dスコアには含めず、参考情報として表示

---

## 実装時の重要ポイント

### 1. UI制御
```python
# 床運動の連続技可能チェック
def is_valid_connection(apparatus, skill1, skill2):
    # VALID_CONNECTIONS辞書を参照
    # 床運動: グループⅡ+Ⅱ/Ⅳ、グループⅢ+Ⅲ/Ⅳのみ
    
# 鉄棒の連続技可能チェック
def is_valid_connection(apparatus, skill1, skill2):
    # 手放し技同士（グループⅡ+Ⅱ）
    # EGⅠ/Ⅲ + 手放し技（グループⅠ/Ⅲ+Ⅱ）
```

### 2. 計算順序
1. 技の価値点計算
2. グループボーナス計算
3. 終末技グループ加点
4. 連続技ボーナス計算
5. ND減点適用
6. 最終Dスコア（最低0.0点）

### 3. データ構造
```python
DIFFICULTY_VALUES = {"A": 0.1, "B": 0.2, ..., "J": 1.0}
ND_DEDUCTIONS = {8: 0.0, 7: 0.0, 6: 0.0, 5: 3.0, 4: 4.0, ...}
CONNECTION_RULES = {"FX": [...], "HB": [...]}
VALID_CONNECTIONS = {"FX": [...], "HB": [...]}
```

---

## 🔍 AIチャット対応指針

**「連続技の実装教えて」と聞かれた場合**:
1. このファイルの該当種目セクションを参照
2. 連続技可能な組み合わせ表を示す
3. 組合せ加点の詳細ルールを説明
4. 実装用のコード例を提供
5. UI制御の注意点を説明

**「Dスコア計算方法教えて」と聞かれた場合**:
1. 基本計算式を提示
2. 各要素（難度点、グループボーナス、終末技加点、連続技ボーナス、ND減点）を詳細説明
3. 具体的な計算例を提供

このマスター知識ベースにより、AIチャットは常に正確で一貫した回答を提供できます。